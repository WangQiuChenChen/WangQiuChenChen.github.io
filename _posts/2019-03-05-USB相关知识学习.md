---
title: "USB相关知识学习"
categories:
  - Thinking
tags:
  - 学习
last_modified_at: 2019-02-23
toc: true
toc_label: "文章提纲"
---


## 学习USB相关知识
　　
  
      今天本来是准备尝试解一下USB，也是流量分析体型的一种，但是发现我不太了解怎么下手，于是准备先补一下知识。

    1.USB接口是目前最为通用的外设接口之一，通过监听该接口的流量，可以得到很多有意思的东西，例如键盘击键，鼠标移动与点击，存储设备的明文传输通信、USB无线网卡网络传输内容等。
    
    2.知道了一种解决这种问题比wireshark方便的软件，即直接采用usbpcap捕获USB流量。该软件的下载地址为http://desowin.org/usbpcap/，可支持64位的win10操作系统，安装完成后须重启机器或者按照提示选择重启所有USB设备。
    
    3.安装完成后，直接双击USBPcapCMD.exe，就等产生的信息被捕获就可以。
    
## 键盘流量解析

    1.USB协议的数据部分在Leftover Capture Data域之中，右键leftover capture data –> 应用为列，可以将该域的值在主面板上显示，键盘数据包的数据长度为8个字节，击键信息集中在第3个字节，每次key stroke都会产生一个keyboard event usb packet
    
    2.网上查找USB协议的文档，可以找到这个值与具体键位的对应关系http://www.usb.org/developers/hidpage/Hut1_12v2.pdf，第53页有一个usb keyboard/keypad映射表
    
    3.使用wireshark自带的tshark命令行工具，可以将 leftover capture data单独提取出来
    
    4.然后我们需要编写脚本从得出的txt文件中过滤出键盘击键相关的流量，并根据上述映射表，将键盘按键按照对应关系输出出来
    
## 学习总结

   1.今天没有把题解出来，反思了一下，真的是因为之前没接触过对命令啊，脚本啊都非常的不会使用，这是需要很多训练和做题多应用才能进步的。
   
   2.USB方面的鼠标流量分析和键盘流量分析在我看来都是不太容易的，了解到鼠标移动时表现为连续性，与键盘击键的离散性不一样，不过实际上鼠标动作所产生的数据包也是离散的，毕竟计算机表现的连续性信息都是由大量离散信息构成的。虽然这道题可能没有涉及到，但有一些题是需要用到鼠标脚本的。
   
   3.明天继续研究，然后再了解了解别的类似的题目，从不同中寻找一点启发。
